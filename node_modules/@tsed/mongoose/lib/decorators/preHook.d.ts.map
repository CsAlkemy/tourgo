{"version":3,"sources":["decorators/preHook.ts"],"names":[],"mappings":"AACA,OAAO,EAAC,iBAAiB,EAAC,MAAM,UAAU,CAAC;AAC3C,OAAO,EAAC,sBAAsB,EAAE,qBAAqB,EAAC,MAAM,eAAe,CAAC;AAG5E,MAAM,WAAW,cAAc;IAC7B,QAAQ,CAAC,EAAE,OAAO,CAAC;IACnB,OAAO,CAAC,EAAE,iBAAiB,CAAC;CAC7B;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA8CG;AACH,wBAAgB,OAAO,CACrB,MAAM,EAAE,MAAM,EACd,EAAE,CAAC,EAAE,qBAAqB,CAAC,GAAG,CAAC,GAAG,sBAAsB,CAAC,GAAG,CAAC,GAAG,cAAc,EAC9E,OAAO,CAAC,EAAE,cAAc,GACvB,QAAQ,CAkBV","file":"preHook.d.ts","sourcesContent":["import {getDecoratorType} from \"@tsed/core\";\nimport {HookErrorCallback} from \"mongoose\";\nimport {MongoosePreHookAsyncCB, MongoosePreHookSyncCB} from \"../interfaces\";\nimport {applySchemaOptions} from \"../utils/schemaOptions\";\n\nexport interface PreHookOptions {\n  parallel?: boolean;\n  errorCb?: HookErrorCallback;\n}\n\n/**\n *\n * We can simply attach a `@PreHook` decorator to your model class and\n * define the hook function like you normally would in Mongoose.\n *\n * ```typescript\n * import {IgnoreProperty, Required} from \"@tsed/common\";\n * import {PreHook, Model} from \"@tsed/mongoose\";\n *\n * @Model()\n * @PreHook(\"save\", (car: CarModel, next) => {\n *    if (car.model === 'Tesla') {\n *        car.isFast = true;\n *      }\n *      next();\n *})\n * export class CarModel {\n *\n *    @IgnoreProperty()\n *    _id: string;\n *\n *    @Required()\n *    model: string;\n *\n *    @Required()\n *    isFast: boolean;\n *\n *    // or Prehook on static method\n *    @PreHook(\"save\")\n *    static preSave(car: CarModel, next) {\n *       if (car.model === 'Tesla') {\n *           car.isFast = true;\n *       }\n *       next();\n *    }\n * }\n * ```\n *\n * This will execute the pre-save hook each time a `CarModel` document is saved.\n *\n * @param {string} method\n * @param fn\n * @param options\n * @returns {Function}\n * @decorator\n * @class\n */\nexport function PreHook(\n  method: string,\n  fn?: MongoosePreHookSyncCB<any> | MongoosePreHookAsyncCB<any> | PreHookOptions,\n  options?: PreHookOptions\n): Function {\n  return (...args: any[]) => {\n    if (getDecoratorType(args) === \"method\") {\n      options = fn as PreHookOptions;\n      fn = args[0][args[1]].bind(args[0]);\n    }\n\n    options = options || {};\n\n    applySchemaOptions(args[0], {\n      pre: [\n        Object.assign(options, {\n          method,\n          fn: fn as MongoosePreHookSyncCB<any> | MongoosePreHookAsyncCB<any>\n        })\n      ]\n    });\n  };\n}\n"],"sourceRoot":"../../src"}